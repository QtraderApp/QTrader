{
    "$id": "contracts.schemas.order.v1.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "Order v1",
    "description": "Represents an order event from the manager service. Contains order placement details before execution.",
    "type": "object",
    "required": [
        "timestamp",
        "symbol",
        "side",
        "quantity",
        "order_type",
        "intent_id",
        "idempotency_key"
    ],
    "properties": {
        "intent_id": {
            "type": "string",
            "minLength": 1,
            "description": "Links back to originating SignalEvent for audit trail. Required for signal-to-order-to-fill chain tracking."
        },
        "idempotency_key": {
            "type": "string",
            "minLength": 1,
            "description": "Replay protection key. ExecutionService rejects duplicate orders with same key. Format: <strategy_id>-<signal_id>-<timestamp>."
        },
        "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "Order creation timestamp - when the order was generated by the manager (UTC RFC3339 with Z suffix)."
        },
        "symbol": {
            "type": "string",
            "minLength": 1,
            "description": "Instrument identifier for the order (e.g., AAPL, BTC-USD)."
        },
        "side": {
            "type": "string",
            "enum": [
                "buy",
                "sell"
            ],
            "description": "Order side - buy to open/increase position, sell to close/decrease position."
        },
        "quantity": {
            "type": "string",
            "pattern": "^\\d+(\\.\\d+)?$",
            "description": "Shares/units to order as decimal string. Always positive."
        },
        "order_type": {
            "type": "string",
            "enum": [
                "market",
                "limit",
                "stop",
                "stop_limit"
            ],
            "description": "Type of order - market (immediate at best price), limit (at specific price or better), stop (trigger at stop price), stop_limit (limit after stop triggered)."
        },
        "limit_price": {
            "type": [
                "string",
                "null"
            ],
            "pattern": "^\\d+(\\.\\d+)?$",
            "description": "Limit price for limit and stop_limit orders as decimal string. Required for order_type='limit' or 'stop_limit'. Null otherwise."
        },
        "stop_price": {
            "type": [
                "string",
                "null"
            ],
            "pattern": "^\\d+(\\.\\d+)?$",
            "description": "Stop trigger price for stop and stop_limit orders as decimal string. Required for order_type='stop' or 'stop_limit'. Null otherwise."
        },
        "time_in_force": {
            "type": "string",
            "enum": [
                "GTC",
                "DAY",
                "IOC",
                "FOK"
            ],
            "description": "Time in force - GTC (good till canceled), DAY (expires end of day), IOC (immediate or cancel), FOK (fill or kill). Defaults to 'GTC'."
        },
        "source_strategy_id": {
            "type": [
                "string",
                "null"
            ],
            "minLength": 1,
            "description": "Strategy that originated the signal leading to this order. For multi-strategy attribution and P&L tracking. Null if not attributed."
        },
        "stop_loss": {
            "type": [
                "string",
                "null"
            ],
            "pattern": "^\\d+(\\.\\d+)?$",
            "description": "Stop loss price as decimal string. If provided, a stop order should be placed to close position if price reaches this level. Null if no stop loss."
        },
        "take_profit": {
            "type": [
                "string",
                "null"
            ],
            "pattern": "^\\d+(\\.\\d+)?$",
            "description": "Take profit price as decimal string. If provided, a limit order should be placed to close position if price reaches this level. Null if no take profit."
        }
    },
    "additionalProperties": false
}
